{
  "__inputs": [
    {
      "name": "DS_TURBO_TIMESCALE",
      "label": "Turbo Timescale",
      "description": "",
      "type": "datasource",
      "pluginId": "postgres",
      "pluginName": "PostgreSQL"
    }
  ],
  "__elements": {},
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "9.4.7"
    },
    {
      "type": "datasource",
      "id": "postgres",
      "name": "PostgreSQL",
      "version": "1.0.0"
    },
    {
      "type": "panel",
      "id": "stat",
      "name": "Stat",
      "version": ""
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "text",
      "name": "Text",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "target": {
          "limit": 100,
          "matchAny": false,
          "tags": [],
          "type": "dashboard"
        },
        "type": "dashboard"
      }
    ]
  },
  "description": "Using the Carbon Metric from Turbonomic directly",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 2,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 31,
      "panels": [
        {
          "datasource": {
            "type": "datasource",
            "uid": "grafana"
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 33
          },
          "id": 33,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# **Applications Carbon Footprint - Private Cloud**\n***\n## **Summary**\nThis dashboard shows the impact of IBM Turbonomic application resource manager on Energy consumption and Carbon Footprint in your private cloud data center environment. \n\nThis dashboard focuses on the calculated Energy and Carbon Footprint data for Virtual Machines (VMs) running in a vSphere environment and includes Energy consumption and Carbon Footprint emissions for VMs, optimization opportunities and their associated net impact on resources, as well as a table comparison of Carbon Footprint across VM groups and Business Applications (see \"Top Applications by CO2e Emissions\" section).\n***\n\n## **Data and Methodology**\n---\n### Energy (Wh) \nVirtual Machine (VM) Energy consumption data is being calculated for individual VM based on the distribution of Host's power data among the VMs running on it. The following methodology is used to quantify Energy consumption for VMs:\n\nConsider the following notation:\n\n**n** - Number of VMs deployed on a Host\\\n**VM_i** - The i-th VM deployed on a Host\\\n**vCPU_i** - The number of vCPUs allocated to  VM~i~ \\\n**P** - Total power consumed by the Host\\\n**U** - Total CPU utilization at the Host (due to hypervisor, OSs, and applications running on all the VMs) \\\n**u_i** - CPU utilization of VM~i~ \\\n**P_idle** - is the power consumed by the Host during active idle state when no process is actively executing \\\n**P_overhead** - is the power consumed due to the hypervisor or other processes that are not specific to any single VM\\\n**P_active** - is the power consumed by the OSs and user processes executing on the VMs \\ \n\n**Host power can be divided into 3 components:**\n\n    P = P_idle + P_overhead + P_active\n\n**The instantaneous power at or over a time interval t for VM_i is then determined as follows:**\n\n    P_VM_i = [(vCPU_i / ∑_(k=1)^n {vCPU_k}) * (P_idle + P_overhead)] + [(u_i / ∑_(k=1)^n {u_k}) * P_active]\n\n\n**Splitting total power into idle, overhead, and active components:** \n\nThe idle power of a Host is determined by fitting a model between the total host utilization U and host power P time series. \n\nThe overhead power P_overhead is given by the power consumption at overhead utilization less P_idle, given by [U - (∑_k{u_k})] . \n\nThat is - **P_overhead** = P * [U - (∑_k{u_k})] - P_idle.\n\n\nFollowing the aforementioned methodology we are able to calculate Power consumption for each individual VM that is running on a Host with available Power data. Then, we are converting Power data into Energy data and showing Energy in Wh units in the \"Energy Consumption (Wh)\" graphs. \n\n---\n### CO2e emissions (t)\nCalculations for Carbon Dioxide equivalents (CO2e in metric tons) emissions are made following an open source methodology outlined in Cloud Carbon Footprint website - [www.cloudcarbonfootprint.org](https://www.cloudcarbonfootprint.org/).\\\nSpecifically, in this dashboard CO2e are calculated using the following formula:\n\n    Operational Emissions = CO2e (t) = (energy consumption [Wh]) x [(private cloud average PUE) x (private cloud emissions factor) / 1000]\n\nWhere:\n\n- ***Private Cloud Power Usage Effectiveness (PUE)*** = An average PUE of 1.67 is used in our calculations. This [451 report](https://d39w7f4ix9f5s9.cloudfront.net/e3/79/42bf75c94c279c67d777f002051f/carbon-reduction-opportunity-of-moving-to-aws.pdf) notes: \"Adding it all up, the power usage effectiveness (PUE, the ratio of total datacenter power and the IT power) ranged from 1.63 to 1.70 in the survey sample and was consistent across company sizes. This is in line with broader industry data collected by the Uptime Institute but well below the efficiency of AWS operations.\" - 451 Research Report. We use the average of 1.63 and 1.70, which is 1.67.\n\n- ***Private Cloud Emissions Factor*** = `1,562.4 lbs CO2/MWh × (4.536 × 10^(-4) metric tons/lb) × 0.001 MWh/kWh = 7.09 × 10^(-4) metric tons CO2/kWh`. We are using `0.000709` (rounded) in our calculations. ***Note:*** Emission equivalents vary slightly vs. EPA calculation because we are using the rounded numbers of the emissions factor (7.09x10^(-4)).\n\n---\n### Graphs and dashboard functionality\n\n- **Top Applications by CO2e emissions** - this table shows the total CO2e emissions over the chosen dashboard period for groups of VMs that are manually created by end users in Turbonomic as well as total CO2e emissions over the chosen dashboard period for VMs within Business Applications groups that are discovred by APM targets added to Turbonomic such as Dynatrace, AppDynamics, Instana, etc.\n\n- **Total Number of VMs** - this graph shows the total number of VMs, both active and idle, discovered by Turbonomnic. \n\n- **Current Number of Resize Actions** - this graph shows the total number VM optimization opportunities, also know as pending VM Resize actions in Turbonomic.\n\n- **VM Resize Actions Impact on VCPU** - this graph shows the net impact on VCPU resources from all the pending VM Resize actions in Turbonomic. \n\n- **VM Resize Actions Impact on VMem** - this graph shows the net impact on VMEM resources from all the pending VM Resize actions in Turbonomic. \n\n- **Global** and **Scoped Information** sections:\n    - **Global** - this section includes inforamation of the global environment over the selected period of time\n    - **Scoped Information** - this section shows information of the scoped environment which can be controlled by the dashboard's top scope selectors such as \"Data Center\" , \"Application(s)\", and \"Virtual Machine(s)\". For each scope selector, one or multiple entries may be selected. \n\n- **PUE** and **Emissions Factor** - these parameters can be adjusted by the user of this dashboard and impact the calculated CO2e in various graphs of this dashboard. See \"CO2e emissions (t)\" section.\n\n\n",
            "mode": "markdown"
          },
          "pluginVersion": "9.4.7",
          "title": "Read Me",
          "type": "text"
        }
      ],
      "title": "Help",
      "type": "row"
    },
    {
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 1
      },
      "id": 19,
      "title": "Global",
      "type": "row"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "This shows the latest data point for the total number of VMs in the selected scope.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "light-blue",
            "mode": "fixed"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 3,
        "x": 0,
        "y": 2
      },
      "id": 15,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "/^count$/",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  m.\"time\" as \"time\",\n  count(m.current)\nFROM metric m\nWHERE\n  $__timeFilter(m.\"time\") AND\n  m.entity_oid IN (${VM_ENERGY_LIST}) AND\n  m.type = 'ENERGY'\nGROUP BY m.time\nORDER BY 1\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Total Number of VMs",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "Current number of pending VM Resize actions. ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-yellow",
            "mode": "fixed"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 3,
        "x": 3,
        "y": 2
      },
      "id": 26,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "/^count$/",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  count(*)\nFROM pending_action a\nwhere\na.type = 'RESIZE' AND\na.target_entity_id IN (${VM_ENERGY_LIST})",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Current Number of Resize Actions",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "Net impact on vCPU resources from pending VM Resize Actions.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "semi-dark-yellow",
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 0
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 3,
        "x": 6,
        "y": 2
      },
      "id": 25,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "sum"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\r\n  (a.attrs->'resizeInfo'->'VCPU'->>'to')::float - (a.attrs->'resizeInfo'->'VCPU'->>'from')::float as \"Difference\"\r\nFROM pending_action a\r\nwhere\r\n  a.target_entity_id IN (${VM_ENERGY_LIST}) AND\r\n  a.\"type\" = 'RESIZE' AND\r\n  a.description like '%VCPU%' AND a.description not like '%limit%'\r\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "VM Resize Actions Impact on VCPU",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "Net impact on vMem resources from pending VM Resize Actions.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "semi-dark-yellow",
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 0
              }
            ]
          },
          "unit": "deckbytes"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 3,
        "x": 9,
        "y": 2
      },
      "id": 27,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "sum"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\r\n  (a.attrs->'resizeInfo'->'VMEM'->>'to')::float - (a.attrs->'resizeInfo'->'VMEM'->>'from')::float as \"Difference\"\r\nFROM pending_action a\r\nwhere\r\n  a.target_entity_id IN (${VM_ENERGY_LIST}) AND\r\n  a.\"type\" = 'RESIZE' AND\r\n  a.description like '%VMem%'",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "VM Resize Actions Impact on VMem",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "List of all applications in the selected scope sorted by the ones with the most carbon emissions over the selected period at the top. Carbon emissions associated with application groups are of the VMs that are part of each application group. ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "purple",
                "value": null
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "CO2e (t)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "masst"
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "mode": "gradient",
                  "type": "gauge"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Grouping Type"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 130
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Application Name"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 274
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 23,
        "w": 12,
        "x": 12,
        "y": 2
      },
      "id": 14,
      "options": {
        "footer": {
          "countRows": false,
          "enablePagination": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": true
        },
        "frameIndex": 1,
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "CO2e (t)"
          }
        ]
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  concat(eapp.name, ' (', eapp.oid,')') as \"Application Name\",\n  eapp.oid as \"Application OID\",\n  s.scoped_oid as \"VM OID\",\n  eapp.type as \"Grouping Type\"\nFROM scope s\njoin entity eapp on eapp.oid = s.seed_oid\nwhere\n  s.scoped_type = 'VIRTUAL_MACHINE'\n  AND s.finish > now()\n  AND eapp.last_seen > now()\n  AND ((eapp.type = 'GROUP' AND eapp.attrs->'member_types' ? 'VIRTUAL_MACHINE' AND '${INCLUDE_GROUPS}') OR (eapp.type = 'BUSINESS_APPLICATION'))\nORDER BY 1",
          "refId": "Groups",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  --mvm.time as \"Time\",\n  mvm.entity_oid as \"VM OID\",\n  sum(mvm.current)/1000/1000 as \"CO2e (t)\"\nFROM metric mvm\nwhere \n  $__timeFilter(mvm.time) AND\n  mvm.entity_oid IN (${VM_ENERGY_LIST}) AND\n  mvm.entity_type = 'VIRTUAL_MACHINE' AND\n  mvm.type = 'CARBON'\nGROUP BY \"VM OID\"\nORDER BY 1",
          "refId": "VM metrics",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top Applications by CO2e emissions",
      "transformations": [
        {
          "id": "merge",
          "options": {}
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Application OID": true,
              "VM OID": true
            },
            "indexByName": {},
            "renameByName": {}
          }
        },
        {
          "id": "groupBy",
          "options": {
            "fields": {
              "Application Name": {
                "aggregations": [],
                "operation": "groupby"
              },
              "Application OID": {
                "aggregations": [],
                "operation": "groupby"
              },
              "CO2e (t)": {
                "aggregations": [
                  "sum"
                ],
                "operation": "aggregate"
              },
              "Carbon Footprint (kg of CO2)": {
                "aggregations": [
                  "sum"
                ],
                "operation": "aggregate"
              },
              "Grouping Type": {
                "aggregations": [],
                "operation": "groupby"
              }
            }
          }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Application OID": false
            },
            "indexByName": {},
            "renameByName": {
              "CO2e (t) (sum)": "CO2e (t)",
              "Carbon Footprint (kg of CO2) (sum)": "Carbon Footprint (kg of CO2)"
            }
          }
        },
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [
              {
                "desc": true,
                "field": "CO2e (t)"
              }
            ]
          }
        },
        {
          "id": "filterByValue",
          "options": {
            "filters": [
              {
                "config": {
                  "id": "isNull",
                  "options": {}
                },
                "fieldName": "Application Name"
              }
            ],
            "match": "any",
            "type": "exclude"
          }
        }
      ],
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "Shows the total energy consumption in Wh for VMs in the selected scope and over the selected time period. ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "orange",
            "mode": "fixed"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "watth"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 7
      },
      "id": 21,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "sum"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "8.5.16",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  m.\"time\" as \"time\",\n  sum(m.current)\nFROM metric m\n--JOIN entity e on m.entity_oid = e.\"oid\" AND e.environment = 'ON_PREM' AND e.type = 'VIRTUAL_MACHINE' and m.entity_type = e.type\nWHERE\n  $__timeFilter(m.\"time\") AND\n  m.entity_oid IN (${VM_ENERGY_LIST}) AND\n  m.type = 'ENERGY'\nGROUP BY m.time\nORDER BY 1",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Total Energy Consumption (Wh) - All VMs",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "Shows the total carbon footprint in tons of CO2e emissions for VMs in the selected scope and over the selected time period. ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "purple",
            "mode": "fixed"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 16
      },
      "id": 7,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "sum"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "8.5.16",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  m.\"time\" as \"time\",\n  sum(m.current)/1000/1000 as \"CO2e (t)\"\nFROM metric m\n--JOIN entity e on m.entity_oid = e.\"oid\" AND e.environment = 'ON_PREM' AND e.type = 'VIRTUAL_MACHINE' and m.entity_type = e.type\nWHERE\n  $__timeFilter(m.\"time\") AND\n  m.entity_oid IN (${VM_ENERGY_LIST}) AND\n  m.type = 'CARBON'\nGROUP BY m.time\nORDER BY 1",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Total Carbon Footprint CO2e (t) - All VMs",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 25
      },
      "id": 17,
      "panels": [],
      "title": "Scoped Information",
      "type": "row"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "This shows the latest data point for the total number of VMs in the selected scope.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "light-blue",
            "mode": "fixed"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 3,
        "x": 0,
        "y": 26
      },
      "id": 29,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "/^count$/",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  m.\"time\" as \"time\",\n  count(m.current)\nFROM metric m\nWHERE\n  $__timeFilter(m.\"time\") AND\n  m.entity_oid IN (${VM_LIST}) AND\n  m.type = 'ENERGY'\nGROUP BY m.time\nORDER BY 1\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Total Number of VMs",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "Current Number of pending VM Resize Actions for all the VMs in the selected scope.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-yellow",
            "mode": "fixed"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 3,
        "x": 3,
        "y": 26
      },
      "id": 28,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "/^count$/",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  count(*)\nFROM pending_action a\nwhere\na.type = 'RESIZE' AND\na.target_entity_id IN (${VM_LIST})",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Current Number of Resize Actions",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "Net impact on vCPU resources from pending VM Resize Actions in the selected scope.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "semi-dark-yellow",
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 0
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 3,
        "x": 6,
        "y": 26
      },
      "id": 23,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "sum"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\r\n  (a.attrs->'resizeInfo'->'VCPU'->>'to')::float - (a.attrs->'resizeInfo'->'VCPU'->>'from')::float as \"Difference\"\r\nFROM pending_action a\r\nwhere\r\n  a.target_entity_id IN (${VM_LIST}) AND\r\n  a.\"type\" = 'RESIZE' AND\r\n  a.description like '%VCPU%' AND a.description not like '%limit%'\r\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "VM Resize Action Impact on VCPU",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "Net impact on vMem resources from pending VM Resize Actions in the selected scope.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "semi-dark-yellow",
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 0
              }
            ]
          },
          "unit": "deckbytes"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 3,
        "x": 9,
        "y": 26
      },
      "id": 24,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "sum"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\r\n  (a.attrs->'resizeInfo'->'VMEM'->>'to')::float - (a.attrs->'resizeInfo'->'VMEM'->>'from')::float as \"Difference\"\r\nFROM pending_action a\r\nwhere\r\n  a.target_entity_id IN (${VM_LIST}) AND\r\n  a.\"type\" = 'RESIZE' AND\r\n  a.description like '%VMem%'",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "VM Resize Action Impact on VMem",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "List of all applications in the selected scope sorted by the ones with the most carbon emissions over the selected period at the top. Carbon emissions associated with application groups are of the VMs that are part of each application group. ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "purple",
                "value": null
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "CO2e (t)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "masst"
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "mode": "gradient",
                  "type": "gauge"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Grouping Type"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 130
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Application Name"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 274
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 23,
        "w": 12,
        "x": 12,
        "y": 26
      },
      "id": 34,
      "options": {
        "footer": {
          "countRows": false,
          "enablePagination": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": true
        },
        "frameIndex": 1,
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "CO2e (t)"
          }
        ]
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  concat(eapp.name, ' (', eapp.oid,')') as \"Application Name\",\n  eapp.oid as \"Application OID\",\n  s.scoped_oid as \"VM OID\",\n  eapp.type as \"Grouping Type\"\nFROM scope s\njoin entity eapp on eapp.oid = s.seed_oid AND s.seed_oid IN (${APPLICATION})\nwhere\n  s.scoped_type = 'VIRTUAL_MACHINE'\n  AND s.finish > now()\n  AND eapp.last_seen > now()\n  AND ((eapp.type = 'GROUP' AND eapp.attrs->'member_types' ? 'VIRTUAL_MACHINE' AND '${INCLUDE_GROUPS}') OR (eapp.type = 'BUSINESS_APPLICATION'))\n  AND s.scoped_oid IN (${VM_LIST})\nORDER BY 1",
          "refId": "Groups",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  --mvm.time as \"Time\",\n  mvm.entity_oid as \"VM OID\",\n  sum(mvm.current)/1000/1000 as \"CO2e (t)\"\nFROM metric mvm\nwhere \n  $__timeFilter(mvm.time) AND\n  mvm.entity_oid IN (${VM_LIST}) AND\n  mvm.entity_type = 'VIRTUAL_MACHINE' AND\n  mvm.type = 'CARBON'\nGROUP BY \"VM OID\"\nORDER BY 1",
          "refId": "VM metrics",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top Applications by CO2e emissions",
      "transformations": [
        {
          "id": "merge",
          "options": {}
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Application OID": true,
              "VM OID": true
            },
            "indexByName": {},
            "renameByName": {}
          }
        },
        {
          "id": "groupBy",
          "options": {
            "fields": {
              "Application Name": {
                "aggregations": [],
                "operation": "groupby"
              },
              "Application OID": {
                "aggregations": [],
                "operation": "groupby"
              },
              "CO2e (t)": {
                "aggregations": [
                  "sum"
                ],
                "operation": "aggregate"
              },
              "Carbon Footprint (kg of CO2)": {
                "aggregations": [
                  "sum"
                ],
                "operation": "aggregate"
              },
              "Grouping Type": {
                "aggregations": [],
                "operation": "groupby"
              }
            }
          }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Application OID": false
            },
            "indexByName": {},
            "renameByName": {
              "CO2e (t) (sum)": "CO2e (t)",
              "Carbon Footprint (kg of CO2) (sum)": "Carbon Footprint (kg of CO2)"
            }
          }
        },
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [
              {
                "desc": true,
                "field": "CO2e (t)"
              }
            ]
          }
        },
        {
          "id": "filterByValue",
          "options": {
            "filters": [
              {
                "config": {
                  "id": "isNull",
                  "options": {}
                },
                "fieldName": "Application Name"
              }
            ],
            "match": "any",
            "type": "exclude"
          }
        }
      ],
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "This graph shows the energy consumption in Watt-hour for VMs in the selected scope and over the selected time. ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "orange",
            "mode": "fixed"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 6,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "watth"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 31
      },
      "id": 11,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "max",
            "mean",
            "sum"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  m.\"time\" as \"time\",\n  sum(m.current)\nFROM metric m\nWHERE\n  $__timeFilter(m.\"time\") AND\n  m.entity_oid IN (${VM_LIST}) AND\n  m.type = 'ENERGY'\nGROUP BY m.time\nORDER BY 1",
          "refId": "Carbon Footprint",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Energy Consumption (Wh) ",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${DS_TURBO_TIMESCALE}"
      },
      "description": "This graph shows the carbon footprint in kg of CO2e emissions for VMs in the selected scope and over the selected time. ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "purple",
            "mode": "fixed"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 6,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 40
      },
      "id": 2,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "max",
            "mean",
            "sum"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "${DS_TURBO_TIMESCALE}"
          },
          "editorMode": "code",
          "format": "time_series",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  m.\"time\" as \"time\",\n  --sum(m.current)*${PRIVATE_CLOUD_AVG_PUE}*${PRIVATE_CLOUD_EMISSIONS_FACTOR}/1000 as \"CO2e (t)\"\n  sum(m.current)/1000/1000 as \"CO2e (t)\"\nFROM metric m\n--JOIN entity e on m.entity_oid = e.\"oid\" AND e.environment = 'ON_PREM' AND e.type = 'VIRTUAL_MACHINE' and m.entity_type = e.type\nWHERE\n  $__timeFilter(m.\"time\") AND\n  m.entity_oid IN (${VM_LIST}) AND\n  m.type = 'CARBON'\nGROUP BY m.time\nORDER BY 1",
          "refId": "Carbon Footprint",
          "select": [
            [
              {
                "params": [
                  "savings"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "completed_action",
          "timeColumn": "recommendation_time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Carbon Footprint CO2e (t)",
      "type": "timeseries"
    }
  ],
  "refresh": "",
  "revision": 1,
  "schemaVersion": 38,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": [
      {
        "current": {},
        "datasource": {
          "type": "postgres",
          "uid": "${DS_TURBO_TIMESCALE}"
        },
        "definition": "select\n    CONCAT(name, ' - ', oid) AS __text,\n    oid AS __value\nfrom entity\nwhere\n    type = 'DATACENTER'\n    --and attrs->>'targets' like '%vCenter%'\n    and last_seen > now()\norder by 1",
        "hide": 0,
        "includeAll": true,
        "label": "Data Center",
        "multi": true,
        "name": "DATACENTER",
        "options": [],
        "query": "select\n    CONCAT(name, ' - ', oid) AS __text,\n    oid AS __value\nfrom entity\nwhere\n    type = 'DATACENTER'\n    --and attrs->>'targets' like '%vCenter%'\n    and last_seen > now()\norder by 1",
        "refresh": 2,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {
          "selected": true,
          "text": "Yes",
          "value": "Yes"
        },
        "hide": 0,
        "includeAll": false,
        "label": "Include Groups",
        "multi": false,
        "name": "INCLUDE_GROUPS",
        "options": [
          {
            "selected": true,
            "text": "Yes",
            "value": "Yes"
          },
          {
            "selected": false,
            "text": "No",
            "value": "No"
          }
        ],
        "query": "Yes, No",
        "queryValue": "",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {},
        "datasource": {
          "type": "postgres",
          "uid": "${DS_TURBO_TIMESCALE}"
        },
        "definition": "select\n    CONCAT(e.name, ' - ', e.type, ' (', e.oid, ')') AS __text,\n    e.oid AS __value\nfrom entity e\njoin scope s on e.oid = s.scoped_oid and s.seed_oid IN (${DATACENTER})\nwhere\n    ((e.type = 'GROUP' AND e.attrs->'member_types' ? 'VIRTUAL_MACHINE' AND '${INCLUDE_GROUPS}')\n    OR (e.type = 'BUSINESS_APPLICATION'))\n    and last_seen > now()\norder by 1",
        "description": "This represents all Virtual Machine groups created in Turbonomic, including VMs that are part of a Business Application or default/user created groups in Turbonomic. ",
        "hide": 0,
        "includeAll": true,
        "label": "Application(s)",
        "multi": true,
        "name": "APPLICATION",
        "options": [],
        "query": "select\n    CONCAT(e.name, ' - ', e.type, ' (', e.oid, ')') AS __text,\n    e.oid AS __value\nfrom entity e\njoin scope s on e.oid = s.scoped_oid and s.seed_oid IN (${DATACENTER})\nwhere\n    ((e.type = 'GROUP' AND e.attrs->'member_types' ? 'VIRTUAL_MACHINE' AND '${INCLUDE_GROUPS}')\n    OR (e.type = 'BUSINESS_APPLICATION'))\n    and last_seen > now()\norder by 1",
        "refresh": 2,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "postgres",
          "uid": "${DS_TURBO_TIMESCALE}"
        },
        "definition": "SELECT\n  distinct e.oid\nFROM entity e\nWHERE\n  (e.first_seen, e.last_seen) OVERLAPS ($__timeFrom(), $__timeTo()) AND\n  e.type = 'VIRTUAL_MACHINE' AND\n  e.environment = 'ON_PREM'",
        "hide": 2,
        "includeAll": true,
        "label": "",
        "multi": true,
        "name": "VM_ENERGY_LIST",
        "options": [],
        "query": "SELECT\n  distinct e.oid\nFROM entity e\nWHERE\n  (e.first_seen, e.last_seen) OVERLAPS ($__timeFrom(), $__timeTo()) AND\n  e.type = 'VIRTUAL_MACHINE' AND\n  e.environment = 'ON_PREM'",
        "refresh": 2,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "postgres",
          "uid": "${DS_TURBO_TIMESCALE}"
        },
        "definition": "SELECT\n    concat(e.name, ' (', e.oid, ')') AS __text,\n    e.oid AS __value\nFROM entity e\njoin scope s on e.oid = s.scoped_oid and s.scoped_type = 'VIRTUAL_MACHINE' AND s.seed_oid IN (${APPLICATION})\nWHERE\n  (e.first_seen, e.last_seen) OVERLAPS ($__timeFrom(), $__timeTo()) AND\n  e.type = 'VIRTUAL_MACHINE' AND\n  e.oid IN (${VM_ENERGY_LIST})\nORDER BY e.name",
        "hide": 0,
        "includeAll": true,
        "label": "Virtual Machine(s)",
        "multi": true,
        "name": "VM_LIST",
        "options": [],
        "query": "SELECT\n    concat(e.name, ' (', e.oid, ')') AS __text,\n    e.oid AS __value\nFROM entity e\njoin scope s on e.oid = s.scoped_oid and s.scoped_type = 'VIRTUAL_MACHINE' AND s.seed_oid IN (${APPLICATION})\nWHERE\n  (e.first_seen, e.last_seen) OVERLAPS ($__timeFrom(), $__timeTo()) AND\n  e.type = 'VIRTUAL_MACHINE' AND\n  e.oid IN (${VM_ENERGY_LIST})\nORDER BY e.name",
        "refresh": 2,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-30d",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Application Carbon Footprint - Private Cloud - v3.6",
  "uid": "AkVTKXQVz",
  "version": 2,
  "weekStart": ""
}